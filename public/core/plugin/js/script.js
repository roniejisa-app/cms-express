const a={endpoint:"",headers:{},body:{},params:{},options:{},setHeaders:(t,e)=>{a.headers[t]=e},setBody:(t,e)=>{a.body[t]=e},buildData:(t,e)=>{if(e==="json")return JSON.stringify(t);if(e==="formData"){const n=new FormData;for(const[r,s]of Object.entries(t))s instanceof FileList?Array.from(s).forEach(o=>{n.append(r,o)}):n.append(r,s);return n}else{let n=[];for(const[r,s]of Object.entries(t))n.push(`${r}=${s}`);return n=n.join("&"),n}},setParam:(t,e)=>{a.params[t]=e},send:async(t,e,n=null,r="json")=>{let s="";const o={headers:a.headers};r==="json"?o.headers["Content-Type"]="application/json":r==="form"?o.headers["Content-Type"]="application/x-www-form-urlencoded":r==="formData"&&delete o.headers["Content-Type"],n&&(t==="GET"||r==="form"||r==="formData"?o.body=a.buildData(n,r):o.body=JSON.stringify(n)),Object.entries(a.params).length&&(s+="?"+a.buildData(a.params)),o.method=t;try{const i=await fetch(`${a.getEndpoint()}${e}${s}`,o),l=await i.json();return{error:!1,response:i,data:l}}catch(i){return{error:{status:100,message:i.message}}}},getEndpoint:()=>a.endpoint,setEndpoint:t=>{a.endpoint=t},get:async(t,e=null,n="json")=>a.send("GET",t,e,n),post:async(t,e,n="json")=>a.send("POST",t,e,n),patch:async(t,e,n="json")=>a.send("PATCH",t,e,n)};window.addEventListener("DOMContentLoaded",function(){document!=null&&document.querySelector('meta[name="csrf-token"]')&&a.setHeaders("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').getAttribute("content"))});(()=>{const t=document.querySelectorAll(".btn-install");for(const e of t)e.addEventListener("click",n=>{n.preventDefault();const r=e.getAttribute("data-name"),s=e.getAttribute("data-type");s==="install"&&(e.innerText="Đang cài đặt..."),s==="uninstall"&&(e.innerText="Đang hủy..."),a.post("/nimda/plugin-i/"+s,{name:r}).then(o=>{s==="install"&&(e.dataset.type="uninstall",e.innerText="Đã cài đặt"),s==="uninstall"&&(e.dataset.type="install",e.innerText="Cài đặt")}).catch(o=>{e.innerText="Cài đặt"})})})();
