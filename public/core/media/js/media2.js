let De=document.querySelector("aside"),q=De.querySelector(".folder-list ul"),$e=document.querySelector(".media-main"),F=$e.querySelector(".files"),L=F.querySelector(".list-item"),Fe=$e.querySelector(".folders"),W=Fe.querySelector(".list-item"),Q=document.querySelector(".media-info");const h={template:(e,t)=>{var i;(i=document.body.querySelector("[notify]"))==null||i.remove();const s=document.createElement("div");s.setAttribute("notify",""),Object.assign(s.style,{position:"fixed",top:"30px",right:"30px",width:"300px",minHeight:"60px",display:"flex",alignItems:"center",overflow:"hidden",zIndex:999999});const n=document.createElement("div");Object.assign(n.style,{position:"relative",width:"100%",padding:"3px",borderRadius:"6px"}),n.innerHTML=`
            <div style="display:flex;background:white;align-items:center; border-radius:6px;height:60px;border-radius:6px;box-shadow:1px 1px 2px">
                <div style="border-top-left-radius:6px;border-bottom-left-radius:6px;background:${e==="success"?"green":"red"};width:10px;height:100%"></div>
                <div style="flex:1; padding: 0 20px;color:${e==="success"?"green":"red"};border-top-right-radius:6px;border-bottom-right-radius:6px">${t}</div>
            </div>
        `,s.append(n),n.animate([{transform:"translateX(100%) rotate(5deg)"},{transform:"translateX(0%)"}],{duration:400,fill:"forwards",easing:"ease-in-out"}).finished.then(o=>{setTimeout(()=>{n.animate([{transform:"translateX(0%)",opacity:1},{transform:"translateX(100%) rotate(-5deg)",opacity:0}],{duration:300,fill:"forwards",easing:"ease-in-out"}).finished.then(a=>{s.remove()})},3e3)}),document.body.append(s)},success:e=>{h.template("success",e)},error:e=>{h.template("error",e)}},z={itemFolder:e=>`<a href="${window.location.pathname}/${e.id}" class="item folder" data-file='${JSON.stringify(e)}'>
                    <img src="/images/admin/folder.svg" alt="${e.filename}">
                    <div class="item-info">
                        <h3>${e.filename}</h3>
                    </div>
                </a>`,itemFolderAside:e=>`<li data-id="${e.id}">
          <a href="${window.location.pathname}/${e.id}">
            <img src="/images/admin/folder.svg" alt="Folder">
            <span>${e.filename}</span>
          </a>
        </li>`,itemFile:e=>{let t=`<label class="item file" data-file='${JSON.stringify(e)}'>
                    <input type="checkbox" name="id" value="${e.id}" hidden>`;return["png","jpeg","jpg","webp","tiff","svg","bmp"].includes(e.extension.toLowerCase())?t+=`<img src="/${e.path_absolute}" alt="${e.filename}">`:["docx","pptx","xlsx","pdf","mp4"].includes(e.extension.toLowerCase())?t+=`<img src="/images/admin/${extension.toLowerCase()}.svg" alt="${e.filename}">`:t+=`<img src="/images/admin/file.svg" alt="${e.filename}">`,t+=`<div class="file-body">
                        <h3>${e.filename}</h3>
                        <ul class="action">`,e.delete_at!==null?t+=`<li>
                                    <button class="restore">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                            <path
                                                d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z" />
                                        </svg>
                                    </button>
                                </li>
                                <li>
                                    <button class="delete-force">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
                                    </button>
                                </li>`:t+=`<li><button class="edit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"/></svg></button></li>
                            <li><button class="delete"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg></button></li>`,t+=`</ul>
                    </div>
                </label>`,t},listItemFolderAside:(e,t=null)=>`<ul>${e.map(n=>`<li>
                <a href="/admin/medias/${t!=null?t+"/":""}${n.id}">
                    ${n.medias&&n.medias?`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
                        <path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z" />
                        </svg>`:""}
                    <img src="/images/admin/folder.svg" alt="${n.filename}">
                    <span>${n.filename}</span>
                </a>
            </li>`).join("")}</ul>`,editFile:(e,t,s,n,i,o)=>`
                <h1>Sửa thông tin</h1>
                ${["png","jpeg","webp","tiff","bmp","jpg"].includes(e)?`
                <div class="image">
                    <img src="/${t}" alt="" />
                </div>
                `:""}
                <form action="/admin/medias/edit-file/${o}">
                <input type="text" name="changeImage" value="0" hidden/>
                <label>
                    <span>Tiêu đề</span>
                    <input type="text" name="filename" value="${s}" placeholder="Nhập tiêu đề file"/>
                </label>
                <label>
                    <span>URL</span>
                    <input type="text" name="path_absolute" value="${window.location.origin+"/"+t}" placeholder="Nhập đường dẫn"/>
                </label>
                <label>
                    <span>Ghi chú</span>
                    <textarea name="note" placeholder="Nhập ghi chú"/>${n??""}</textarea>
                </label>
                <label>
                    <span>Mô tả</span>
                    <textarea name="description" cols="30" placeholder="Nhập mô tả">${i??""}</textarea>
                </label>
            </form>`,templateFolder:e=>{let t="";return t+="<ul>",e.delete_at?t+=`<li>
                <button class="restore">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"/></svg>
                    Phục hồi
                </button>
            </li>
            <li>
                <button class="delete-force">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path
                            d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z" />
                    </svg>
                    Xóa
                </button>
            </li>`:t+=`<li>
                <button class="edit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>
                    Chỉnh sửa
                </button>
            </li>
            <li>
                <button class="delete">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <path
                            d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z" />
                    </svg>
                    Thùng rác
                </button>
            </li>`,t+="</ul>",t}};new Event("update-process-event");const T={headers:{"Content-Type":"application/json"},eventUploads:{},body:{},params:{},endpoint:"",type:"",send:function(e,t,s={}){return new Promise((n,i)=>{const o=new XMLHttpRequest;for(const[u,b]of Object.entries(this.eventUploads))o.upload.addEventListener(u,b);this.setBody(s),this.type===""?this.setHeader("Content-Type","application/json"):this.type==="form"?this.setHeader("Content-Type","application/x-www-form-urlencoded"):this.type==="formData"&&this.setHeader("Content-Type","multipart/form-data"),o.addEventListener("progress",function(u){let b=+(u.loaded/u.total*100).toFixed(2),f=document.body.querySelector(".progress-upload");document.body.querySelector(".progress-upload")||(f=document.createElement("div"),f.className="progress-upload",f.innerHTML=`<span></span>
                                        <svg width="100" height="100" viewBox="0 0 100 100" class="circular-progress">
                                            <defs>
                                            <linearGradient id="GradientColor">
                                                <stop offset="0%" stop-color="yellow"></stop>
                                                <stop offset="50%" stop-color="red"></stop>
                                                <stop offset="100%" stop-color="#80afe7"></stop>
                                            </linearGradient>
                                            </defs>
                                            <circle class="bg"></circle>
                                            <circle class="fg"></circle>
                                        </svg>`,document.body.append(f));const x=f.querySelector("span");f.querySelector(".circular-progress").style.setProperty("--progress",b),x.innerText=`${b}%`,b===100&&f.animate([{opacity:1},{opacity:0}],{duration:1e3,easing:"ease-in-out"}).finished.then(function(){f.remove()})}),o.responseType="json",o.onreadystatechange=()=>{o.readyState===XMLHttpRequest.DONE&&o.status===200&&n(o.response)},o.addEventListener("process",u=>{dispatchEvent(event)});let a=this.getParams(),c=this.endpoint+t+(a?"?"+a:""),m=this.buildBody();if(o.open(e,c),Object.keys(this.headers).length)for(let u of Object.keys(this.headers))this.type==="formData"&&u==="Content-Type"||o.setRequestHeader(u,this.headers[u]);o.send(m)})},setEventUpload:function(e,t){this.eventUploads[e]=t},setType:function(e){this.type=e},buildBody:function(){if(this.type==="formData"||this.type==="formExpress"){const e=new FormData;for(let t of Object.keys(this.body))if(Array.isArray(this.body[t]))for(const s of this.body[t])e.append(t,s);else e.append(t,T.body[t]);return e}else return JSON.stringify(this.body)},setBody:function(e){this.body=e},getParams:function(){return Object.entries(this.params).map(([e,t])=>`${e}=${t}`).join("&")},setParams:function(e,t){this.params[e]=t},setHeader:function(e,t){this.headers[e]=t},setEndpoint:function(e){this.endpoint=e},get:async(e,t={})=>T.send("get",e,t),post:async(e,t={})=>T.send("post",e,t),patch:async(e,t={})=>T.send("PATCH",e,t)},ye="https://localhost:3000",se=new Event("cut-canvas-image");T.setEndpoint(ye);let M=0,X=1,V={},me,fe,v,O,Y,Le,ie,S,N,j,k,A;function Oe(e,t,s,n,i){e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 32v448h448V32H0zm358.4 179.2h-89.6v89.6h-89.6v89.6H89.6V121.6h268.8v89.6z"/></svg><p>Lật ảnh</p>',t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M48.5 224H40c-13.3 0-24-10.7-24-24V72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8H48.5z"/></svg>
    <p>Xoay Trái</p>`,s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M463.5 224H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5z"/></svg>
    <span>Xoay phải</span>`,e.onclick=()=>{X=1,M=0,X===1?X=-1:X=1,ue()},t.onclick=()=>{X=1,M=0,M-=90,ue()},s.onclick=()=>{X=1,M=0,M+=90,M===360&&(M=0),ue()},n&&(n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z"/></svg><p>Khôi phục</p>',n.addEventListener("click",async function(){if(confirm("Bạn có muốn khôi phục lại ảnh gốc không?"))try{const o=await T.patch(`/admin/medias/edit-file/${i}`,{changeImage:"original"});if(o.status===200){h.success(o.message);let a=Array.from(L.children).find(c=>JSON.parse(c.dataset.file).id===o.data.id);a.insertAdjacentHTML("beforebegin",z.itemFile(o.data)),a.remove(),dispatchEvent(le),document.querySelector('.edit-file .edit-info button[type="button"]').click()}else h.error(o.message)}catch(o){h.error(o.message)}}))}function Re(e,t,s,n){V={imageContainer:e,imgEditEl:t,imgEl:s,inputChangeImage:n},e.style.position="relative",e.style.fontSize=0,t.style.pointerEvents="none",e.style.userSelect="none";let i=!1;v=document.createElement("div");const o=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),m=document.createElement("div");Xe(o,a,c,m,v,t),v.append(o,a,c,m),e.append(v),V.divEl=v,V.croppedCanvasContainer=v,o.addEventListener("mousedown",function(){i=!0,S=v.getBoundingClientRect(),Le=S.left+S.width,ie=S.top+S.height,O=e.getBoundingClientRect().left,Y=e.getBoundingClientRect().top,document.addEventListener("mousemove",b)}),a.addEventListener("mousedown",function(){i=!0,S=v.getBoundingClientRect(),ie=S.top+S.height,O=e.getBoundingClientRect().left,Y=e.getBoundingClientRect().top,document.addEventListener("mousemove",f)}),c.addEventListener("mousedown",function(l){i=!0,S=v.getBoundingClientRect(),O=e.getBoundingClientRect().left,Y=e.getBoundingClientRect().top,document.addEventListener("mousemove",x)}),m.addEventListener("mousedown",function(l){i=!0,S=v.getBoundingClientRect(),document.addEventListener("mousemove",p)}),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mousemove",f),document.removeEventListener("mousemove",x),document.removeEventListener("mousemove",p),document.removeEventListener("mousemove",u),i&&Ne(),i=!1}),v.addEventListener("mousedown",l=>{l.target===v&&(me=v.style.left,fe=v.style.top,O=l.clientX,Y=l.clientY,document.addEventListener("mousemove",u))});function u(l){const r=v.parentElement.getBoundingClientRect(),d=v.getBoundingClientRect(),g=r.width-d.width,w=r.height-d.height;let E,C;const Z=Math.abs(l.clientX-O),I=Math.abs(l.clientY-Y);E=+me.replace("px",""),C=+fe.replace("px",""),E=E+(l.clientX>=O?Z:-Z),C=C+(l.clientY>=Y?I:-I),E>g?E=g:E<0&&(E=0),C>w?C=w:C<0&&(C=0),v.style.left=E+"px",v.style.top=C+"px",A=E,k=C,(v.style.left!==me||v.style.top!==fe)&&(i=!0)}function b(l){const r=l.clientX,d=l.clientY;A=r-O,k=d-Y,N=Le-r,j=ie-d,te()}function f(l){const r=l.clientX,d=l.clientY;k=d-Y,A=S.left-O,N=r-S.left,j=ie-d,te()}function x(l){const r=l.clientX,d=l.clientY;k=v.offsetTop,A=r-O,N=S.width+S.left-r,j=d-S.top,te()}function p(l){const r=l.clientX,d=l.clientY;k=v.offsetTop,A=v.offsetLeft,N=r-S.left,j=d-S.top,te()}}function te(e=!1){if(e){const s=k;k=A,A=s}j>=20&&k>=0&&(v.style.top=k+"px"),N>=20&&A>=0&&(v.style.left=A+"px");const t=v.parentElement.getBoundingClientRect();k+j>t.height&&(j=t.height-k),A+N>t.width&&(N=t.width-A),N>=20&&A>=0&&(v.style.width=N+"px"),j>=20&&k>=0&&(v.style.height=j+"px")}function Xe(e,t,s,n,i,o){i.style.position="absolute",i.style.top=0,i.style.zIndex=3,i.style.left=0,i.style.background="rgba(0,0,0,0.1)",i.style.width=`${o.offsetWidth}px`,i.style.height=`${o.offsetHeight}px`,i.style.cursor="move",N=o.offsetWidth,j=o.offsetHeight,A=0,k=0,i.style.border="1px solid white",[e,t,s,n].forEach(a=>{a.style.width="10px",a.style.height="10px",a.style.borderRadius="50%",a.style.position="absolute",a.style.border="1px solid white",a.style.background="black",a.style.zIndex=3}),e.style.cursor="nwse-resize",t.style.cursor="sw-resize",s.style.cursor="sw-resize",n.style.cursor="nwse-resize",e.style.transform="translate(-50%,-50%)",t.style.transform="translate(50%,-50%)",t.style.right=0,t.style.top=0,s.style.transform="translate(-50%, 50%)",s.style.bottom=0,s.style.left=0,n.style.transform="translate(50%, 50%)",n.style.bottom=0,n.style.right=0}function Ne(){if(V.croppedCanvasContainer&&V.imgEl&&V.imgEditEl){const{croppedCanvasContainer:e,imgEl:t,imgEditEl:s}=V;se.croppedCanvasContainer=e,se.imgEl=t,se.imgEditEl=s,window.dispatchEvent(se)}}function Ve(){window.addEventListener("cut-canvas-image",function(e){const{croppedCanvasContainer:t,imgEl:s,imgEditEl:n}=e,{inputChangeImage:i}=V,o=n.offsetWidth,a=n.offsetHeight,c=n.naturalWidth,m=n.naturalHeight,u=c/o,b=m/a,f=document.createElement("canvas");let x=f.getContext("2d");const p=new Image;p.src=n.src,p.onload=()=>{const l=document.createElement("div");f.width=t.offsetWidth*u,f.height=t.offsetHeight*b,l.append(p),l.append(f),l.style.position="relative",l.style.width=p.naturalWidth+"px",l.style.height=p.naturalHeight+"px",f.style.position="absolute",f.style.left=+t.style.left.replace("px","")*u+"px",f.style.top=+t.style.top.replace("px","")*b+"px";let r=+f.style.left.replace("px",""),d=+f.style.top.replace("px",""),g=0,w=0;x.drawImage(p,r,d,f.width,f.height,g,w,f.width,f.height),i.value="new",s.src=f.toDataURL()}})}function ue(){const{imgEditEl:e,imgEl:t}=V,s=document.createElement("canvas");let n=s.getContext("2d");const i=new Image;i.src=e.src,i.onload=()=>{Math.abs(M)===90?(s.width=i.naturalHeight,s.height=i.naturalWidth):(s.width=i.naturalWidth,s.height=i.naturalHeight);let o=0;M!==0&&(n.rotate(M*Math.PI/180),M===90?n.translate(0,-s.width):M===-90&&n.translate(-s.height,0)),X===-1&&(n.scale(X,1),o=+(s.width*X)),n.drawImage(i,o,0),e.src=s.toDataURL(),e.onload=()=>{t.src=e.src,te(Math.abs(M)===90),Ne()}}}const y={endpoint:"",headers:{},body:{},params:{},options:{},setHeaders:(e,t)=>{y.headers[e]=t},setBody:(e,t)=>{y.body[e]=t},buildData:(e,t)=>{if(t==="json")return JSON.stringify(e);if(t==="formData"){const s=new FormData;for(const[n,i]of Object.entries(e))i instanceof FileList?Array.from(i).forEach(o=>{s.append(n,o)}):s.append(n,i);return s}else{let s=[];for(const[n,i]of Object.entries(e))s.push(`${n}=${i}`);return s=s.join("&"),s}},setParam:(e,t)=>{y.params[e]=t},send:async(e,t,s=null,n="json")=>{let i="";const o={headers:y.headers};n==="json"?o.headers["Content-Type"]="application/json":n==="form"?o.headers["Content-Type"]="application/x-www-form-urlencoded":n==="formData"&&delete o.headers["Content-Type"],s&&(e==="GET"||n==="form"||n==="formData"?o.body=y.buildData(s,n):o.body=JSON.stringify(s)),Object.entries(y.params).length&&(i+="?"+y.buildData(y.params)),o.method=e;try{const a=await fetch(`${y.getEndpoint()}${t}${i}`,o),c=await a.json();return{error:!1,response:a,data:c}}catch(a){return{error:{status:100,message:a.message}}}},getEndpoint:()=>y.endpoint,setEndpoint:e=>{y.endpoint=e},get:async(e,t=null,s="json")=>y.send("GET",e,t,s),post:async(e,t,s="json")=>y.send("POST",e,t,s),patch:async(e,t,s="json")=>y.send("PATCH",e,t,s)};window.addEventListener("DOMContentLoaded",function(){document!=null&&document.querySelector('meta[name="csrf-token"]')&&y.setHeaders("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').getAttribute("content"))});let ge=qe();const je=new Event("has-new-folder"),Pe=new Event("add-all-action"),Ye=new Event("refresh-event-folder");function qe(){return q&&q.querySelectorAll("a")}function Ce(){Fe.querySelectorAll(".list-item .item").forEach(t=>{t.addEventListener("contextmenu",function(s){s.preventDefault();let n=document.querySelector(".menu-folder");n&&n.remove();const i=s.pageX,o=s.pageY;n=document.createElement("div"),n.className="menu-folder";const a=JSON.parse(t.dataset.file);n.dataset.file=t.dataset.file,n.innerHTML=z.templateFolder(a),document.body.append(n),n.style.left=i+"px",n.style.top=o+"px",n.querySelectorAll("ul li button").forEach(m=>{m.addEventListener("click",async function(u){const b=a.id;switch(m.className){case"edit":const f=document.createElement("form");f.classList.add("form-add-folder");const x=document.createElement("div");x.classList.add("form-container");const p=document.createElement("input");p.placeholder="Nhập tên thư mục...",p.value=a.filename;const l=document.createElement("button");x.append(p,l),f.append(x),l.innerText="Sửa thư mục",f.onsubmit=async r=>{l.setAttribute("disabled",!0),r.preventDefault(),y.setEndpoint("");const d=await y.post(`/admin/medias/edit/folder/${a.id}`,{folderName:p.value});d.data.status===200?(h.success(d.data.message),a.filename=d.data.folderName,t.dataset.file=JSON.stringify(a),t.querySelector("h3").innerText=d.data.folderName,q.querySelector(`[data-id="${a.id}"] span`).innerText=d.data.folderName):h.error(d.data.message),f.remove()},f.onclick=r=>{r.target===f&&f.remove()},document.body.append(f);break;case"delete":if(confirm("Chuyển mục này vào thùng rác!")){y.setEndpoint("");const r=await y.post(`/admin/medias/delete/${a.id}`);if(r.data.status===200){h.success(r.data.message),t.remove(),n&&n.remove(),W.children.length===0&&(W.innerHTML="<p>Chưa có thư mục nào!</p>");const d=Array.from(q.children).find(g=>+g.dataset.id==+a.id);d&&d.closest("li").remove(),q.children.length===0&&(q.innerHTML="<ul><p>Chưa có thư mục nào!</p></ul>")}else h.error(r.data.message)}break;case"restore":try{const r=await y.post("/admin/medias/restore-all",{ids:[b],restore:!0});r.data.status===200?(h.success(r.data.message),t.remove(),n&&n.remove(),W.children.length===0&&(W.innerHTML="<p>Chưa có thư mục nào!</p>")):h.error(r.data.message)}catch{h.error("Thử lại sau!")}break;case"delete-force":if(confirm("Bạn có chắc muốn xóa tệp tin này? Chúng sẽ không còn xuất hiện trên blog của bạn, bao gồm bài viết, trang, và widget. Hành động này không thể phục hồi.")){const r=await T.post("/admin/medias/delete-force",{ids:[a.id]});r.status===200?(h.success(r.message),t.remove(),n&&n.remove(),W.children.length===0&&(L.innerHTML="<p>Không có tệp tin nào!</p>")):h.error(r.message)}break}})}),n.addEventListener("mousedown",function(m){m.stopPropagation()})})}),document.addEventListener("mousedown",function(t){let s=document.querySelector(".menu-folder");s&&s.remove()})}function He(){if(!ge)return!1;for(const t of ge)t.onclick=e;async function e(t){if((t.target.nodeName==="svg"||t.target.nodeName==="path")&&(t.preventDefault(),!this.nextElementSibling)){const s=this.getAttribute("href").replace("/admin/medias/",""),n=await y.get("/admin/medias/folder/"+s);this.insertAdjacentHTML("afterend",z.listItemFolderAside(n.data.folders,n.data.id)),window.dispatchEvent(je)}}}function ve(){for(const e of L.children){const{id:t,customs:s,filename:n,description:i,note:o,path_absolute:a,extension:c}=JSON.parse(e.dataset.file),m=JSON.parse(s),u=e.querySelector(".delete"),b=e.querySelector(".edit"),f=e.querySelector(".restore"),x=e.querySelector(".delete-force");e.addEventListener("mouseover",function(){this.classList.add("show")}),e.addEventListener("mouseleave",function(){this.classList.remove("show")}),u&&(u.onclick=async()=>{if(confirm("Chuyển mục này vào thùng rác!"))try{y.setEndpoint("");const p=await y.post(`/admin/medias/delete/${t}`);p.data.status===200?(h.success(p.data.message),e.remove()):h.error(p.data.message),L.children.length===0&&(L.innerHTML="<p>Không có tệp tin nào!</p>")}catch{h.error("Thử lại sau!")}}),b&&(b.onclick=()=>{let p=document.querySelector(".edit-file");document.querySelector(".edit-file")&&document.querySelector(".edit-file").remove(),p=document.createElement("div");const l=document.createElement("div");p.className="edit-file",l.className="edit-container",p.append(l);let r,d;if(["png","jpeg","webp","tiff","bmp","jpg"].includes(c)){const I=document.createElement("div"),P=document.createElement("div"),ne=document.createElement("div"),be=document.createElement("button"),xe=document.createElement("button"),Ee=document.createElement("button");ne.className="toolbar",ne.append(xe,be,Ee);let de;m.pathAbsoluteOriginal&&(de=document.createElement("button"),ne.append(de)),Oe(be,xe,Ee,de,t),P.className="edit-image-container",r=document.createElement("div"),r.className="image-container",d=document.createElement("img"),d.src=`/${a}`,r.append(d),P.append(r),I.append(P,ne),I.className="edit-image",l.append(I)}const g=document.createElement("div");g.className="edit-info",l.appendChild(g),document.body.append(p),document.body.style.height="100vh",document.body.style.overflow="hidden",g.innerHTML=z.editFile(c,a,n,o,i,t);const w=g.querySelector("form"),E=g.querySelector(".image img"),C=w.querySelector('input[name="changeImage"]');E&&(d.onload=()=>{Re(r,d,E,C)}),Ue(w,g),w.insertAdjacentHTML("beforeend",`<div class="action">
                        <button class="btn btn-reset" type="button">Đóng</button>
                        <button class="btn btn-submit" type="submit">Lưu</button>
                    </div>`),l.querySelector(".btn-reset").addEventListener("click",function(I){document.body.style.removeProperty("height"),document.body.style.removeProperty("overflow"),p.remove()})}),f&&(f.onclick=async()=>{if(confirm("Bạn muốn khôi phục tệp tin này!")){const p=await T.post("/admin/medias/restore-all",{ids:[t]});p.status===200?(h.success(p.message),e.remove(),L.children.length===0&&(L.innerHTML="<p>Không có tệp tin nào!</p>")):h.error(p.message)}}),x&&(x.onclick=async()=>{if(confirm("Bạn có chắc muốn xóa tệp tin này? Chúng sẽ không còn xuất hiện trên blog của bạn, bao gồm bài viết, trang, và widget. Hành động này không thể phục hồi.")){const p=await T.post("/admin/medias/delete-force",{ids:[t]});p.status===200?(h.success(p.message),e.remove(),L.children.length===0&&(L.innerHTML="<p>Không có tệp tin nào!</p>")):h.error(p.message)}})}}function Ue(e,t){e.addEventListener("submit",async function(s){s.preventDefault();const n=Object.fromEntries([...new FormData(s.target)]);if(n.changeImage==="new"){const o=t.querySelector(".image img");n.base64Image=o.src}const i=window.location.pathname.replace("/admin/medias","");n.media_id=i;try{const o=await T.patch(e.getAttribute("action"),n);if(o.status===200){h.success(o.message);let a=Array.from(L.children).find(c=>JSON.parse(c.dataset.file).id===o.data.id);a.insertAdjacentHTML("beforebegin",z.itemFile(o.data)),a.remove(),dispatchEvent(le),e.querySelector('button[type="button"]').click()}else h.error(o.message)}catch(o){h.error(o.message)}})}function Je(){He(),ve(),Ce(),window.addEventListener("add-all-action",ve),window.addEventListener("has-new-folder",()=>{ge=qe(),He()}),window.addEventListener("refresh-event-folder",Ce)}const Ke=(e,t=2)=>{if(!+e)return"0 Bytes";const s=1024,n=t<0?0:t,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return`${parseFloat((e/Math.pow(s,o)).toFixed(n))} ${i[o]}`};let _=L.querySelectorAll(".item"),We=new Event("show-info-file"),H,ee,U,J,pe,he,G,B,ae,we=!1;function Se(e){if(e.preventDefault(),!e.target.closest(".item")){we=!0,ae=D(),H=document.createElement("canvas"),document.body.append(H),ee=H.getContext("2d");const t=F.getBoundingClientRect();U=e.pageX-t.left-window.pageXOffset,J=e.pageY-t.top-window.pageYOffset,F.style.position="relative",H.style.position="absolute",H.style.zIndex="9999",H.width=F.clientWidth,H.height=F.clientHeight,H.style.left=0,H.style.top=0,F.append(H),B=document.createElement("div"),B.style.position="absolute",B.style.zIndex="1000",F.append(B)}}function Te(e){if(we){let t,s;e.target===H&&(t=e.offsetX-U,s=e.offsetY-J,ee.clearRect(0,0,H.width,H.height),ee.beginPath(),ee.rect(U,J,t,s),ee.fillStyle="#80afe799",ee.fill(),pe=e.offsetX,he=e.offsetY,e.offsetX>=U&&e.offsetY>=J?G={x:U,y:J}:e.offsetX>=U&&e.offsetY<=J?G={x:U,y:he}:e.offsetX<=U&&e.offsetX&&e.offsetY>=J?G={x:pe,y:J}:G={x:pe,y:he},B.style.width=Math.abs(t)+"px",B.style.height=Math.abs(s)+"px",B.style.top=G.y+"px",B.style.left=G.x+"px",Array.from(_).forEach(n=>{ke(n,B)&&e.ctrlKey&&ae.includes(n)?n.firstElementChild.checked=!1:ke(n,B)||e.ctrlKey&&ae.includes(n)||e.shiftKey&&ae.includes(n)?n.firstElementChild.checked||(n.firstElementChild.checked=!0):n.firstElementChild.checked=!1}))}}function Me(){B&&B.remove(),G=void 0,we=!1,H&&H.remove()}function ke(e,t){const s=e.getBoundingClientRect(),n=t.getBoundingClientRect();return s.left<n.left+n.width&&s.left+s.width>n.left&&s.top<n.top+n.height&&s.top+s.height>n.top}function ze(){for(const e of _)e.onclick=function(t){t.preventDefault();const s=this;let n=D("start"),i=D("last"),o=D();if(!t.ctrlKey&&!t.shiftKey)o.length&&o.forEach(a=>{a!==this&&(a.firstElementChild.checked=!1)}),this.firstElementChild.checked=!0;else if(t.ctrlKey)this.firstElementChild.checked?this.firstElementChild.checked=!1:this.firstElementChild.checked=!0;else if(t.shiftKey)if(o.length){let a=null;for(let c=n.index;c<=i.index;c++)if(!o[c]){a=c-1;break}if(s.index>=i.index&&!a){let c=i.index+1;for(;c<=s.index;)_[c].firstElementChild.checked=!0,c++}else if(s.index>=i.index&&a){let c=a+1;for(;c<=s.index;)_[c].firstElementChild.checked=!0,c++}else if(s.index<=i.index&&s.index>=n.index&&!a)for(let c=n.index;c<=i.index;c++)o[c].firstElementChild.checked=c<=s.index;else if(s.index<=i.index&&s.index>=n.index&&a)for(let c=n.index;c<=i.index;c++)o[c]&&(o[c].firstElementChild.checked=c<=s.index);else if(s.index<n.index){let c=s.index;for(;c<=n.index;)_[c].firstElementChild.checked=!0,c++}}else Array.from(_).filter((a,c)=>c<=s.index).forEach(a=>a.firstElementChild.checked=!0);window.dispatchEvent(We)}}function D(e=void 0){const t=[];let s=null,n=null,i=0;for(const a of _)a.firstElementChild.checked&&(s===null&&(s=i),n=i,t[i]=a),i++;let o;switch(e){case"start":return o={index:s,item:t[s]},o;case"last":return o={index:n,item:t[n]},o;default:return t}}function _e(){H&&(H.width=F.clientWidth,H.height=F.clientHeight),_=L.querySelectorAll(".item"),ze(),ve()}function Ge(){F.addEventListener("mousedown",Se),document.addEventListener("mousemove",Te),document.addEventListener("mouseup",Me),F.addEventListener("touchstart",Se),document.addEventListener("touchmove",Te),document.addEventListener("touchend",Me),document.addEventListener("mousedown",function(e){!e.target.closest(".item")&&!e.ctrlKey&&!e.shiftKey&&D().forEach(t=>t.firstElementChild.checked=!1)}),window.addEventListener("refresh-event",_e),window.addEventListener("show-info-file",function(){let e=D("last");if(e.index===null||e.index===void 0)return Q.innerHTML='<p class="text-center">Chọn tệp để xem thông tin</p>',!1;let t=JSON.parse(e.item.dataset.file),s=t.customs?JSON.parse(t.customs):[];if(Object.keys(s).length===0)return Q.innerHTML='<p class="text-center">Chọn tệp để xem thông tin</p>',!1;let n={};const i=document.createElement("img"),o=document.createElement("table"),a=document.createElement("tbody");let c=document.createElement("tr");Q.innerHTML="",Q.innerHTML=`<h1>Thông tin</h1>
                            <div class="image"></div>
                            <div class="info-body"></div>`;const m=Q.querySelector(".image"),u=Q.querySelector(".info-body");o.append(a),u.append(o),a.append(c);let b=!1;s.extension&&s.pathAbsolute&&(["png","gif","jpg","webp","jpeg","svg"].includes(s.extension)?(i.src=`/${s.pathAbsolute}`,b=!0):["docx","mp4","pdf","xlsx","pptx"].includes(s.extension)?i.src=`/images/admin/${s.extension}.svg`:i.src="/images/admin/file.svg",i.src&&m.append(i)),i.src?i.onload=x=>f(x,b):f();function f(x,p=!1){n.filename=s.filename,n.extension=s.extension,n.size=Ke(s.size),p&&(n.natural=`${i.naturalWidth} ✕ ${i.naturalHeight}`),n.created_at=s.created_at;for(const[l,r]of Object.entries(n))if(r){if(c.children.length>=2){let d=document.createElement("tr");a.append(d),c=d}switch(l){case"filename":c.insertAdjacentHTML("beforeend",`<td>
                            <div class="title">Tên tệp tin</div>
                            <div class="info">${r}</div>
                        </td>`);break;case"extension":c.insertAdjacentHTML("beforeend",`<td>
                            <div class="title">Định dạng</div>
                            <div class="info">${r}</div>
                        </td>`);break;case"size":c.insertAdjacentHTML("beforeend",`<td>
                            <div class="title">Dung lượng</div>
                            <div class="info">${r}</div>
                        </td>`);break;case"natural":c.insertAdjacentHTML("beforeend",`<td>
                            <div class="title">Kích thước</div>
                            <div class="info">${r}</div>
                        </td>`);break;case"created_at":const d=new Date(r),g=d.getDate(),w=d.getMonth(),E=d.getFullYear();c.insertAdjacentHTML("beforeend",`<td>
                            <div class="title">Ngày tải lên</div>
                            <div class="info">${g} tháng ${w} ${E}</div>
                        </td>`);break}}}}),ze()}const le=new Event("refresh-event"),oe=new Event("choose-image"),Ae=document.querySelector(".add-folder"),Ie=document.querySelector(".upload-file");let $=new DataTransfer;const Ze=new Event("add-folder"),Qe=new Event("add-file"),ce=new Event("load-item");let R,K,re;window.addEventListener("add-folder",e=>{R=document.createElement("form"),R.classList.add("form-add-folder");const t=document.createElement("div");t.classList.add("form-container");const s=document.createElement("input");s.placeholder="Nhập tên thư mục...";const n=document.createElement("button");t.append(s,n),R.append(t);const i=window.location.pathname.replace("/admin/medias","");n.innerText="Thêm thư mục",R.onsubmit=async o=>{n.setAttribute("disabled",!0),o.preventDefault(),y.setEndpoint(ye+"/admin");const a=await y.post("/medias/add/folder",{folderName:s.value,media_id:i});if(a.data.status==="NOT OK")h.error(a.data.errors[0].folderName);else{W.querySelector("a")||(W.innerHTML=""),q.querySelector("li")||(q.innerHTML="");let c=q.querySelector(`[href="/admin/medias/${i.startsWith("/")?i.slice(1):i}"]`);if(!c)q.insertAdjacentHTML("beforeend",z.itemFolderAside(a.data.folder));else if(c.nextElementSibling)c.nextElementSibling.insertAdjacentHTML("beforeend",z.itemFolderAside(a.data.folder));else{const m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttributeNS(null,"viewBox","0 0 320 512"),m.innerHTML='<path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z"></path>',c.prepend(m),c.insertAdjacentHTML("afterend",`<ul>${z.itemFolderAside(a.data.folder)}</ul>`)}window.dispatchEvent(je),W.insertAdjacentHTML("beforeend",z.itemFolder(a.data.folder)),h.success(a.data.message),R.remove(),window.dispatchEvent(Ye)}},R.onclick=o=>{o.target===R&&R.remove()},document.body.append(R)});window.addEventListener("add-file",e=>{K=document.createElement("form"),K.classList.add("form-add-file"),K.onclick=i=>{i.target===K&&Be()};const{divContainer:t,input:s,button:n}=et();K.append(t),K.onsubmit=async i=>{i.preventDefault(),n.setAttribute("disabled",!0),T.setEndpoint(ye+"/admin");const o=window.location.pathname.replace("/admin/medias","");T.setType("formData");const a=await T.post("/medias/add/file",{files:Array.from(s.files),media_id:o});a.status===200?(L.querySelector(".item")||(L.innerHTML=""),ce.items=a.successFiles,window.dispatchEvent(ce),h.success(a.message),Be(),window.dispatchEvent(le)):(h.error(a.message),n.removeAttribute("disabled"))},document.body.append(K)});function et(){let e=null,t=document.createElement("div");const s=document.createElement("div"),n=document.createElement("input"),i=document.createElement("button"),o=document.createElement("div"),a=document.createElement("span"),c=document.createTextNode(0),m=document.createTextNode("");a.style.color="white",a.innerText="Đã chọn (",m.data=")",a.append(c,m),o.className="items",t.className="upload-place",s.classList.add("form-container"),n.type="file",n.setAttribute("hidden",""),n.setAttribute("multiple",""),i.innerText="Thêm file",i.className="btn-submit",t.append(o),s.append(a,i,t,n),u(),t.ondragover=l=>{l.preventDefault()};function u(){t.onclick=l=>{(l.target===t||l.target===o)&&n.click()},n.onchange=l=>{const r=l.target.files;let d=$.files;const g=$.items;if(d.length===0){for(const w of r)g.add(w);f(b())}else{const w=Array.from(r).filter(E=>Array.from(d).some(C=>x(C,E))?!1:(g.add(E),!0));w.length&&f(w)}b()}}function b(){return n.files=$.files,c.data=$.files.length,$.files}function f(l){re=Array.from(l).map((r,d)=>{const g=r.name,w=g.slice(g.lastIndexOf(".")+1),E=URL.createObjectURL(r),C=document.createElement("div"),Z=document.createElement("span"),I=document.createElement("img"),P=document.createElement("button");return Z.innerText=g,C.className="item",["png","jpeg","jpg","webp","tiff","svg","bmp"].includes(w.toLowerCase())?I.src=E:["docx","pptx","xlsx","pdf","mp4"].includes(w.toLowerCase())?I.src=`/images/admin/${w.toLowerCase()}.svg`:I.src="/images/admin/file.svg",P.type="button",P.innerHTML="&times;",C.setAttribute("data-info",JSON.stringify({name:r.name,type:r.type,size:r.size})),C.append(I,P,Z),{itemEl:C,url:E,button:P,name:r.name,type:r.type,size:r.size}}),o.append(...re.map(r=>r.itemEl)),o.ondragover=r=>{r.preventDefault()},re.forEach(r=>{r.button.onclick=d=>{d.preventDefault();const g=Array.from($.files).findIndex(w=>x(w,r));$.items.remove(g),r.itemEl.remove(),URL.revokeObjectURL(r.url),b()},r.itemEl.draggable=!0,r.itemEl.ondragstart=d=>{e=r.itemEl},r.itemEl.ondragover=d=>{d.preventDefault();const g=d.target.closest(".item");if(g){const w=g.offsetWidth/2;d.offsetX>w?g.parentElement.insertBefore(g,e):d.offsetX<=w&&g.parentElement.insertBefore(e,g)}},r.itemEl.ondrop=()=>{e=null,p()}})}function x(l,r){return l.name===r.name&&l.size===r.size&&l.type===r.type}function p(){const l=new DataTransfer,r=o.children;for(const d of r){const g=Array.from($.files).findIndex(w=>x(w,JSON.parse(d.dataset.info)));g!==-1&&l.items.add($.files[g])}$=l,b()}return{divContainer:s,input:n,button:i}}function Be(){K.remove(),$=new DataTransfer;for(const{url:e}of re)URL.revokeObjectURL(e)}window.addEventListener("load-item",e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(t=>{L.insertAdjacentHTML("afterbegin",z.itemFile(t))})});function tt(){Ae&&(Ae.onclick=e=>{window.dispatchEvent(Ze)}),Ie&&(Ie.onclick=e=>{window.dispatchEvent(Qe)})}function nt(){let e=new URLSearchParams(window.location.search).get("page")??1,t=!1,s=new IntersectionObserver(n);async function n(o){for(const a of o)if(a.isIntersecting&&!t){e++,t=!0;const{pathname:c}=window.location;y.setParam("page",e),y.setParam("isJson",1),s.disconnect();try{const m=await y.get(c);m.data&&m.data.rows&&m.data.rows.length&&(ce.items=m.data.rows,window.dispatchEvent(ce),i=L.children[L.children.length-1],s.observe(i),t=!1,window.dispatchEvent(le),window.dispatchEvent(Pe))}catch(m){console.log(m.message)}}}let i=L.children[L.children.length-1];i&&s.observe(i)}const st=(()=>{function e(){const i=document.querySelector(".events .delete");i&&i.addEventListener("click",async o=>{if(confirm("Bạn có muốn xóa các tệp tin đã chọn?")){let a=D(),c=a.map(u=>JSON.parse(u.dataset.file).id);i.setAttribute("disabled",!0);const m=await T.post("/admin/medias/delete-all",{ids:c});m.status===200?(h.success(m.message),a.forEach(u=>u.remove())):h.error(m.message),i.removeAttribute("disabled")}}),i&&i.addEventListener("mousedown",o=>{o.stopPropagation()})}function t(){const i=document.querySelector(".events .restore");i&&i.addEventListener("click",async o=>{if(confirm("Bạn có muốn khôi phục các tệp tin đã chọn?")){let a=D(),c=a.map(u=>JSON.parse(u.dataset.file).id);i.setAttribute("disabled",!0);const m=await T.post("/admin/medias/restore-all",{ids:c});m.status===200?(h.success(m.message),a.forEach(u=>u.remove())):h.error(m.message),i.removeAttribute("disabled")}}),i&&i.addEventListener("mousedown",o=>{o.stopPropagation()})}function s(){const i=document.querySelector(".events .delete-force");i&&i.addEventListener("click",async o=>{if(confirm("Bạn có chắc muốn xóa tệp tin này? Chúng sẽ không còn xuất hiện trên blog của bạn, bao gồm bài viết, trang, và widget. Hành động này không thể phục hồi?")){let a=D(),c=a.map(u=>JSON.parse(u.dataset.file).id);i.setAttribute("disabled",!0);const m=await T.post("/admin/medias/delete-force",{ids:c});m.status===200?(h.success(m.message),a.forEach(u=>u.remove())):h.error(m.message),i.removeAttribute("disabled")}}),i&&i.addEventListener("mousedown",o=>{o.stopPropagation()})}function n(){const i=document.querySelector(".events .choose-file");i&&(i.addEventListener("click",function(o){const a=window.frameElement;if(!a)return!1;const c=a.dataset.uuid,m=a.dataset.type,u=D(m);if(!u.item)return h.error("Vui lòng chọn tệp tin");oe.uuid=c,oe.data=u.item.dataset.file,oe.typeImage=m,window.parent.dispatchEvent(oe)}),i.addEventListener("mousedown",function(o){o.stopPropagation()}))}return{init:()=>{e(),t(),s(),n()}}})();window.addEventListener("DOMContentLoaded",function(){st.init(),Ge(),tt(),nt(),Je(),Ve()});
